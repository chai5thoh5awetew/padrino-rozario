#!/usr/bin/env ruby
# encoding: utf-8

# –¢–µ—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–∏—Å—Ç–µ–º—ã –æ—Ç–ø—Ä–∞–≤–∫–∏ email –¥–ª—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤

puts "=== –¢–ï–°–¢ –û–¢–ü–†–ê–í–ö–ò EMAIL –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ï–í ==="

def simulate_comment_email_sending(order_id = nil, rating = 5)
  puts "–¢–µ—Å—Ç–∏—Ä—É–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É email –¥–ª—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è..."
  puts "–ü–∞—Ä–∞–º–µ—Ç—Ä—ã: order_id=#{order_id || '–æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}, rating=#{rating}"
  
  # –°–∏–º—É–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
  user_name = "–¢–µ—Å—Ç–æ–≤—ã–π –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"
  user_email = "test.user@example.com"
  user_id = 12345
  comment_text = "–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤—ã–π –æ—Ç–∑—ã–≤ –æ –∫–∞—á–µ—Å—Ç–≤–µ —Ü–≤–µ—Ç–æ–≤. –û—á–µ–Ω—å –¥–æ–≤–æ–ª—å–Ω—ã!"
  
  # –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–∞ –ø–∏—Å—å–º–∞ –∫–∞–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ
  order_info = order_id ? "\n–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞: #{order_id}" : ""
  user_id_info = "\nID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: #{user_id}"
  msg_body = "–ò–º—è: #{user_name}\n–≠–ª. –ø–æ—á—Ç–∞: #{user_email}\n–û—Ç–∑—ã–≤: #{comment_text}\n–û—Ü–µ–Ω–∫–∞: #{rating}#{order_info}#{user_id_info}"
  
  puts "–ü—Ä–∏–º–µ—Ä —Ç–µ–ª–∞ –ø–∏—Å—å–º–∞:"
  puts "---"
  puts msg_body
  puts "---"
  
  # –°–∏–º—É–ª—è—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å Thread.new
  puts "–õ–æ–≥–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:"
  puts "1. –û–ø—Ä–µ–¥–µ–ª—è–µ–º recipient_email = ENV['ORDER_EMAIL']"
  puts "2. –°–æ–∑–¥–∞—ë–º Thread.new do ... end"
  puts "3. –í–Ω—É—Ç—Ä–∏ thread –≤—ã–ø–æ–ª–Ω—è–µ–º email do ... end"
  puts "4. FROM: no-reply@rozarioflowers.ru (–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –¥–æ–º–µ–Ω)"
  puts "5. TO: ORDER_EMAIL"
  puts "6. SUBJECT: –û—Ç–∑—ã–≤ —Å —Å–∞–π—Ç–∞"
  puts "7. –ù–µ –∂–¥—ë–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è thread (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ)"
  puts 
  
  # –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Ä–∞–±–æ—á–µ–π —Å–∏—Å—Ç–µ–º–æ–π
  puts "–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Å–∏—Å—Ç–µ–º–æ–π –∑–∞–∫–∞–∑–æ–≤:"
  puts "‚úÖ –û–¥–∏–Ω–∞–∫–æ–≤—ã–π –¥–æ–º–µ–Ω: rozarioflowers.ru"
  puts "‚úÖ –û–¥–∏–Ω–∞–∫–æ–≤–∞—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å: Thread.new do ... end"
  puts "‚úÖ –û–¥–∏–Ω–∞–∫–æ–≤—ã–π –ø–æ–ª—É—á–∞—Ç–µ–ª—å: ORDER_EMAIL"
  puts "‚úÖ –û–¥–∏–Ω–∞–∫–æ–≤—ã–µ TLS —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã"
  puts "---"
end

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
puts "1. –û—Ç–∑—ã–≤ –±–µ–∑ –∑–∞–∫–∞–∑–∞:"
simulate_comment_email_sending()
puts

puts "2. –û—Ç–∑—ã–≤ —Å –Ω–æ–º–µ—Ä–æ–º –∑–∞–∫–∞–∑–∞:"
simulate_comment_email_sending(87654321, 5)
puts

puts "3. –û—Ç–∑—ã–≤ —Å –Ω–∏–∑–∫–æ–π –æ—Ü–µ–Ω–∫–æ–π:"
simulate_comment_email_sending(12345678, 2)
puts

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
puts "=== –ü–†–û–í–ï–†–ö–ê –û–ë–†–ê–¢–ù–û–ô –°–í–Ø–ó–ò ==="
puts

messages = [
  "–°–ø–∞—Å–∏–±–æ! –í–∞—à –æ—Ç–∑—ã–≤ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.", # –ë–µ–∑ –∑–∞–∫–∞–∑–∞
  "–°–ø–∞—Å–∏–±–æ! –í–∞—à –æ—Ç–∑—ã–≤ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –∏ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –∑–∞–∫–∞–∑—É –∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.", # –° –∑–∞–∫–∞–∑–æ–º
  "–°–ø–∞—Å–∏–±–æ! –í–∞—à –æ—Ç–∑—ã–≤ —Å–æ—Ö—Ä–∞–Ω–µ–Ω. (Email –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω - –æ—à–∏–±–∫–∞ –ø–æ—á—Ç–æ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞)" # –û—à–∏–±–∫–∞
]

messages.each_with_index do |msg, index|
  status = case index
  when 0, 1
    "‚úÖ –£–°–ü–ï–•"
  when 2
    "‚ùå –û–®–ò–ë–ö–ê"
  end
  
  puts "#{index + 1}. #{status}: #{msg}"
end

puts "\n=== –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï ==="
puts "‚úÖ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —Ç–µ–ø–µ—Ä—å –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Ç–∞–∫ –∂–µ, –∫–∞–∫ –∑–∞–∫–∞–∑—ã!"
puts "‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ (Thread.new)"
puts "‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –¥–æ–º–µ–Ω rozarioflowers.ru"
puts "‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Å–µ–≥–¥–∞ –≤–∏–¥–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —Å—Ç–∞—Ç—É—Å–µ"

puts "\n–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ! üéÜ"
