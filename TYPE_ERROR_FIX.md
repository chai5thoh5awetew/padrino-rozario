# üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ TypeError –≤ –∞–¥–º–∏–Ω–∫–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–ø–∏—Å–∫–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –≤ –∞–¥–º–∏–Ω–∫–µ –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –æ—à–∏–±–∫–∞:

```
TypeError at /admin/comments
no implicit conversion of Float into String
file: output_safety.rb location: concat line: 133
```

**–ü—Ä–∏—á–∏–Ω–∞:** HAML helper `content_tag` –æ–∂–∏–¥–∞–µ—Ç —Å—Ç—Ä–æ–∫—É –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ, –Ω–æ –ø–æ–ª—É—á–∞–ª Float –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –ø–æ–ª—è `comment.rating`.

## –ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –º–µ—Å—Ç–∞ –≤ –∫–æ–¥–µ

```haml
# –ü–†–û–ë–õ–ï–ú–ù–û: content_tag –ø–æ–ª—É—á–∞–µ—Ç Float
=is_published ? comment.rating : content_tag(:strong, comment.rating)
=is_published ? comment.name : content_tag(:strong, comment.name)  # –µ—Å–ª–∏ name –º–æ–∂–µ—Ç –±—ã—Ç—å nil
- body_text = truncate_words(strip_tags(comment.body))  # –µ—Å–ª–∏ body –º–æ–∂–µ—Ç –±—ã—Ç—å nil
=is_published ? body_text : content_tag(:strong, body_text)
```

## –†–µ—à–µ–Ω–∏–µ

–î–æ–±–∞–≤–ª–µ–Ω–æ —è–≤–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ —Å—Ç—Ä–æ–∫—É `.to_s` –¥–ª—è –≤—Å–µ—Ö –∑–Ω–∞—á–µ–Ω–∏–π, –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã—Ö –≤ `content_tag`:

```haml
# –ò–°–ü–†–ê–í–õ–ï–ù–û: –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–µ–æ–±—Ä–∞–∑—É—é—Ç—Å—è –≤ —Å—Ç—Ä–æ–∫–∏
=is_published ? comment.rating : content_tag(:strong, comment.rating.to_s)
=is_published ? comment.name : content_tag(:strong, comment.name.to_s)
- body_text = truncate_words(strip_tags(comment.body.to_s))
=is_published ? body_text : content_tag(:strong, body_text.to_s)
```

## –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### `/admin/views/comments/index.haml`

**–°—Ç—Ä–æ–∫–∞ —Å —Ä–µ–π—Ç–∏–Ω–≥–æ–º:**
```haml
# –ë—ã–ª–æ:
=is_published ? comment.rating : content_tag(:strong, comment.rating)

# –°—Ç–∞–ª–æ:
=is_published ? comment.rating : content_tag(:strong, comment.rating.to_s)
```

**–°—Ç—Ä–æ–∫–∞ —Å –∏–º–µ–Ω–µ–º:**
```haml
# –ë—ã–ª–æ:
=is_published ? comment.name : content_tag(:strong, comment.name)

# –°—Ç–∞–ª–æ:
=is_published ? comment.name : content_tag(:strong, comment.name.to_s)
```

**–°—Ç—Ä–æ–∫–∞ —Å —Ç–µ–∫—Å—Ç–æ–º –æ—Ç–∑—ã–≤–∞:**
```haml
# –ë—ã–ª–æ:
- body_text = truncate_words(strip_tags(comment.body))
=is_published ? body_text : content_tag(:strong, body_text)

# –°—Ç–∞–ª–æ:
- body_text = truncate_words(strip_tags(comment.body.to_s))
=is_published ? body_text : content_tag(:strong, body_text.to_s)
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç `fix_type_error_test.rb` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:

‚úÖ **Float –∑–Ω–∞—á–µ–Ω–∏—è** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `4.5`) –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–µ–æ–±—Ä–∞–∑—É—é—Ç—Å—è
‚úÖ **Integer –∑–Ω–∞—á–µ–Ω–∏—è** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `5`) —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ –ø—Ä–µ–∂–¥–µ  
‚úÖ **nil –∑–Ω–∞—á–µ–Ω–∏—è** –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
‚úÖ **–°—Ç—Ä–æ–∫–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è** –æ—Å—Ç–∞—é—Ç—Å—è –Ω–µ–∏–∑–º–µ–Ω–Ω—ã–º–∏

**–†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
```
‚úÖ Float (4.5) -> <strong>4.5</strong>
‚úÖ Integer (5) -> <strong>5</strong>  
‚úÖ nil (nil) -> <strong></strong>
```

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–µ—Ç–∞–ª–∏

**–ü—Ä–∏—á–∏–Ω–∞ –æ—à–∏–±–∫–∏:**
HAML helper `content_tag` –≤ Rails –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç string concatenation, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –º–æ–∂–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å Float –≤ String.

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Ä–µ—à–µ–Ω–∏—è:**
- `.to_s` - —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –ª—é–±—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ Ruby
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ –¥–ª—è nil –∑–Ω–∞—á–µ–Ω–∏–π: `nil.to_s => ""`
- –ù–µ –∏–∑–º–µ–Ω—è–µ—Ç –ª–æ–≥–∏–∫—É –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
- –û–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ

## –í–ª–∏—è–Ω–∏–µ –Ω–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

**–î–û –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–∞–¥–∞–ª–∞ —Å TypeError  
**–ü–û–°–õ–ï –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤—Å–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:

- –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–µ: –æ–±—ã—á–Ω—ã–π —à—Ä–∏—Ñ—Ç
- –ù–µ–æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–µ: –∂–∏—Ä–Ω—ã–π —à—Ä–∏—Ñ—Ç + –∂—ë–ª—Ç—ã–π —Ñ–æ–Ω
- Float —Ä–µ–π—Ç–∏–Ω–≥–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "4.5")
- nil –∑–Ω–∞—á–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–∞–∫ –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏

## –ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –±—É–¥—É—â–µ–≥–æ:**
1. –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `.to_s` –ø—Ä–∏ –ø–µ—Ä–µ–¥–∞—á–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ `content_tag`
2. –£—á–∏—Ç—ã–≤–∞—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å nil –∑–Ω–∞—á–µ–Ω–∏–π –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å —Ä–∞–∑–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö (Float, Integer, nil, String)

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ  
**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:** 1 —Ñ–∞–π–ª (admin/views/comments/index.haml)  
**–¢–∏–ø –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ (–æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ–µ)  
**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** ‚úÖ –ü—Ä–æ–π–¥–µ–Ω–æ —Å —Ä–∞–∑–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö  

**–î–∞—Ç–∞:** 11.10.2025  
**–ö–æ–º–º–∏—Ç:** fix TypeError in admin comments by converting values to strings for content_tag  
